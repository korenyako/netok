# Netok — UI спецификация (Окно, Настройки, Токены)

Версия: **UI-SPEC v1 (2025-09-08)**

Эта спецификация фиксирует визуальные и UX-решения для MVP Netok. Без кода, только поведение и копирайт. Актуально для RU-локали (EN добавим зеркально).

---

## 1) Окно приложения

* **Дефолтный размер:** ширина **300 px**, высота **480 px**.
* **Минимальный размер окна:** ширина **240 px**, высота **360 px**. Ниже — запрещаем.
* **Ресайз:** свободный, поддерживаем **maximize**.
* **Запоминание:** сохраняем последний размер/позицию и восстанавливаем при запуске.
* **Хедер (верхний блок 3 строки):** всегда фиксирован сверху; основной контент скроллится под ним.
* **Брейкпоинты верстки:**

  * **Compact ≤ 320 px:** один столбец, узлы в виде строчных карточек (бусина + краткая подпись), детали сворачиваются.
  * **Regular 321–600 px:** стандартный вид, показываем ключевые строки (IP, Сигнал, Скорость).
  * **Spacious > 600 px:** больше отступов, подсказки, можно показывать панель деталей справа.

## 2) Навигация по настройкам (сайдбар)

* **Лэйаут:** слева **сайдбар** с разделами, справа — список настроек выбранного раздела.
* **Ширина сайдбара:** 160–200 px (адаптивно: 160 в Regular, 200 в Spacious).
* **Compact режим:** сайдбар заменяется на **верхний таб-бар** или селектор «Раздел».
* **Заголовок раздела** закреплён над списком настроек.

### Разделы настроек (предложение)

1. **Общие**
   — Язык интерфейса (RU / EN)  
   — Показ геоданных (вкл/выкл) *(влияет только на страну/город в «Интернет»)*  
   — Запоминать размер окна (вкл)

2. **Сеть**
   — Тип соединения *(только чтение)*  
   — Показывать «Название сети (SSID)» (вкл)  
   — Отображать «Сигнал» (вкл)

3. **DNS**
   — Режим DNS: Автоматически / Cloudflare 1.1.1.1 / Google 8.8.8.8 / Свой вариант  
   — Поле для «Свой DNS» (валидация IPv4/IPv6)  
   — Кнопка **Очистить DNS-кэш**

4. **Приватность**
   — Сбор анонимной телеметрии (выкл по умолчанию)  
   — Отправлять отчёты об ошибках (спросить каждый раз)  
   — Публичный IP и гео: показывать на экране (вкл)

5. **Внешний вид**
   — Тема: Светлая / Тёмная / Системная  
   — Плотность: Компактная / Стандартная  
   — Шрифт: Inter / Roboto *(только выбор, поставляем вместе с приложением)*

6. **Инструменты**
   — **Короткий тест скорости** (кнопка)  
   — **Открыть страницу входа Wi-Fi**  
   — **Открыть страницу роутера**  
   — **Скопировать результат проверки**

7. **О программе**
   — Версия приложения, лицензии шрифтов/иконок, ссылка «Сообщить о проблеме».

## 3) Скролл и поведение списков

* В списках (узлы, настройки) при нехватке места — **вертикальный скролл**.
* На macOS можно использовать автоскрытие, на Windows/Linux — **всегда видимый** скроллбар.
* **Толщина:** 8 px, радиус скролл-ползунка — 8 px, трек — приглушённый.
* Верхний блок статуса **не скроллится**.

## 4) Типографика и шрифты

* **Основной шрифт:** **Inter** (вес 400/500/600).
* **Альтернатива:** Roboto (или Roboto Flex) — по переключателю в «Внешний вид».
* **Размеры (Regular):**
  * Заголовок страницы: 16 px / 600
  * Заголовки групп: 14 px / 600
  * Обычный текст: 13 px / 400–500
  * Подписи/вспомогательный текст: 12 px / 400
* **Compact:** минус 1 px к каждому пункту.
* Межстрочный: 1.35–1.45, чёткие фокусы для доступности.

## 5) Кнопки и интерактив

* **Радиус:** 10–12 px.
* **Паддинги:** минимум 8×12 px (Compact), 10×14 px (Regular).
* **Состояния:** default / hover / active / focus / disabled.
* **Фокус-кольцо:** 2 px, цвет primary/доступный, видимый на любом фоне.
* **Тумблеры, селекты, инпуты** — единый стиль; placeholder приглушённый, не серый-на-сером.

## 6) Иконки (SVG)

* Рекомендация: **Lucide** *или* **Material Symbols Rounded** (единый набор на весь проект).
* **Размеры:** 16 px (Compact), 20–24 px (Regular/Spacious).
* **Цвет:** `currentColor`; stroke 1.5 px (для Lucide).
* **Набор на MVP:** Copy, External Link, Refresh, Settings, Info, Chevron, Globe, Wifi, Ethernet, Router, Computer.

## 7) Бусины-индикаторы

* **Геометрия:** круг 10–12 px, отступ справа 8 px.
* **Состояния:**
  * Работает — **#22C55E** (зелёный)
  * Недоступно — **#EF4444** (красный)
  * Частично — **#F59E0B** (оранжевый)
  * Неизвестно — **#9CA3AF** (серый)
  * Идёт проверка — обводка **#3B82F6** + мягкая пульсация (500–800 мс)
* Для дальтоников смысл дублируем фактом в тексте; цвет — лишь усиление.

## 8) Цветовые токены (Light/Dark)

### Light
* Background: **#FFFFFF**
* Surface: **#F7F7F8**
* Text Primary: **#111827**
* Text Secondary: **#6B7280**
* Border/Subtle: **#E5E7EB**
* Primary (акценты/фокус): **#3B82F6**
* Danger: **#EF4444**
* Warning: **#F59E0B**
* Success: **#22C55E**

### Dark
* Background: **#111827**
* Surface: **#1F2937**
* Text Primary: **#F9FAFB**
* Text Secondary: **#D1D5DB**
* Border/Subtle: **#374151**
* Primary: **#60A5FA**
* Danger: **#F87171**
* Warning: **#FBBF24**
* Success: **#34D399**

## 9) Копирайт (RU) — готовые строки

* Верхний блок:  
  — «Интернет работает.» / «Интернет недоступен.» / «Интернет частично.»  
  — «Скорость: {down}/{up} Мбит/с»
* Кнопки: «Обновить», «Настройки», «Копировать», «Открыть страницу роутера», «Открыть страницу входа Wi-Fi»
* Узлы: **Компьютер → Сеть → Роутер → Интернет**
* Сеть (Wi-Fi): «Сигнал: отличный/хороший/средний/слабый ({rssi} dBm)», «Название сети: {ssid}»
* Сеть (Кабель): «Линк: есть/нет»
* Роутер: «IP в локальной сети: {ip}»
* Интернет: «Оператор: {isp}», «IP: {ip}», «{country}, {city}» *(если включено)*
* Экспорт: «Результат проверки Netok — {date} {time}»

## 10) Правила «неизвестно»

* Показываем «неизвестно» **только для важных полей** (например, «Сигнал: неизвестно»).
* Второстепенные строки — **скрываем**.
* Если SSID есть, а RSSI нет — показываем SSID и «Сигнал: неизвестно».
* Если оператор не определён — показываем только IP (без строки «Оператор»).

## 11) QA-сценарии (минимальный набор)

1. **Первый запуск**: SSID есть, RSSI нет → SSID виден, «Сигнал: неизвестно».
2. **После «Обновить»**: появился RSSI → показываем уровень сигнала; последующие обновления не откатывают в «неизвестно», пока драйвер стабилен.
3. **Окно 240×360**: всё кликабельно, скролл есть, хедер фиксирован.
4. **Настройки/сайдбар**: при ширине 300 px сайдбар превращается в таб-бар; при 800+ — обычный двухколоночный вид.
5. **Фокус-навигация**: все интерактивные элементы доступны по клавиатуре, видно кольцо фокуса.
6. **Тёмная тема**: контраст текста и интерактивов ≥ WCAG AA.

## 12) Предустановленные ассеты

* **Шрифты:** Inter (Regular, Medium, SemiBold).
* **Иконки:** выбранная библиотека (вся в /assets/icons, SVG, префикс `ic_*.svg`).
* **Бусины:** рисуем вектором (круги), без эмодзи.

## 13) Интернационализация (i18n)

### Архитектура системы
* **Система:** Hybrid JSON + hardcoded для производительности
* **Файлы:** `/i18n/en.json`, `/i18n/ru.json` (JSON формат)
* **Модуль:** `/desktop/src/i18n.rs` с функциями `s()`, `t()`, `is_fact_key()`
* **Fallback:** английский → hardcoded → error message
* **Загрузка:** один раз при старте, переключение мгновенное

### Категории ключей
* **General:** основные элементы (`AppName`, `Loading`, `Settings`)
* **Nodes:** названия узлов (`NodeComputer`, `NodeNetwork`, `NodeRouter`, `NodeInternet`)
* **Network types:** типы сетей (`NetworkWifi`, `NetworkCable`, `NetworkUsbModem`)
* **Fact keys:** ключи данных (`FactSignal`, `FactType`, `FactModel`)
* **Settings:** разделы настроек (`SettingsGeneral`, `SettingsDns`)
* **Status:** статусы интернета (`InternetOk`, `InternetPartial`, `InternetDown`)

### Функции API

#### Простые строки: `s(S::Key)`
```rust
// Базовое использование
text(s(S::AppName))           // "Netok"
button(s(S::Refresh))         // "Обновить" / "Refresh"
title(s(S::NodeComputer))     // "Компьютер" / "Computer"
```

#### Шаблонные строки: `t(key, args)`
```rust
// Скорость интернета
t("SpeedValue", &[("down", "100"), ("up", "50")])
// → "Скорость: 100/50 Мбит/с" / "Speed: 100/50 Mbps"

// Сигнал Wi-Fi
t("SignalValue", &[("grade", "отличный"), ("dbm", "-45")])
// → "отличный (-45 dBm)" / "excellent (-45 dBm)"
```

#### Проверка ключей данных: `is_fact_key(fact, S::Key)`
```rust
// Умная проверка фактов в обоих языках
if is_fact_key(fact_name, S::FactSignal) {
    // Обрабатываем "Сигнал" или "Signal"
}
if is_fact_key(fact_name, S::FactType) {
    // Обрабатываем "Тип" или "Type"
}
```

### Правила локализации

#### Русский язык (ru.json)
* **Тон:** профессиональный, дружелюбный
* **Терминология:** устоявшиеся IT-термины (DNS, IP, Wi-Fi)
* **Сокращения:** используем (`Вкл`/`Выкл`, `Мбит/с`)
* **Пунктуация:** русская типографика (`...` вместо `…`)
* **Соответствие:** терминология Windows/macOS на русском

#### Английский язык (en.json)
* **Тон:** четко, кратко
* **Терминология:** стандартные технические термины
* **Сокращения:** принятые (`On`/`Off`, `Mbps`)
* **Пунктуация:** стандартная английская
* **Соответствие:** платформенные конвенции

#### Универсальные правила
* **Плейсхолдеры:** сохраняем `{key}` без изменений
* **Контекст:** учитываем ограничения места в UI
* **Пользователь:** пишем с точки зрения пользователя
* **Доступность:** избегаем сложного жаргона

### Переключение языка
* **UI расположение:** Настройки → Общие → Язык
* **Радио-кнопки:** Русский / English
* **Применение:** мгновенное, без перезапуска
* **Сохранение:** только в памяти (планируется persistence)
* **По умолчанию:** русский язык

### Техническая интеграция

#### Добавление новых строк
1. **Enum:** добавить в `S` enum (`/desktop/src/i18n.rs`)
2. **Maps:** добавить в `RU` и `EN` static maps
3. **JSON:** обновить `en.json` и `ru.json`
4. **Код:** использовать `s(S::NewKey)` в UI

#### Проверка качества
* **Pre-commit hook:** блокирует кириллицу в `desktop/src/`
* **Тесты:** `cargo test test_i18n` для базовой проверки
* **Ручное тестирование:** переключение языков в приложении

#### Добавление языков
1. Создать `/i18n/xx.json` (где xx — код языка)
2. Скопировать из `en.json`, перевести значения
3. При необходимости добавить в UI селектор языка

### Анти-паттерны (НЕ делать)
* ❌ Хардкод текста: `text("Настройки")` → ✅ `text(s(S::Settings))`
* ❌ Прямое сравнение: `k == "Сигнал"` → ✅ `is_fact_key(k, S::FactSignal)`
* ❌ Смешивание языков: русские ключи в английском интерфейсе
* ❌ Забывать плейсхолдеры: `"{down} Мбит/с"` без подстановки

### Производительность
* **Startup:** загрузка JSON ~1ms
* **Runtime:** HashMap lookup ~10ns
* **Memory:** ~50KB для всех переводов
* **Switching:** ~100μs для переключения языка

### Расширения (roadmap)
* **Persistence:** сохранение выбора языка в конфиге
* **Pluralization:** правила для множественного числа
* **RTL support:** поддержка арабского/иврита
* **Dynamic loading:** загрузка переводов по требованию

## 14) Открытые вопросы (для следующей итерации)

* Нужно ли в «Внешний вид» переключение размера шрифта (Small/Medium/Large)?
* Анимации: оставляем только пульсацию у «идёт проверка» или добавляем fade-in у обновлений строк?

---

## Changelog

* 2025-09-11: v1.2 — расширен раздел i18n (§13) с подробными правилами и примерами.
* 2025-01-11: v1.1 — добавлены правила i18n (§13).
* 2025-09-08: v1 — первичная фиксация UI-SPEC (Окно, Настройки, Токены).
